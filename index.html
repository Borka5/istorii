<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–∞–π—Ç —Å –∏—Å—Ç–æ—Ä–∏—è–º–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .story-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-title {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .story-text {
            line-height: 1.6;
            color: #444;
        }
        .nav-menu {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 20px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            transition: color 0.3s;
        }
        .nav-menu a:hover {
            color: #ffd700;
        }
        .story-form {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-form h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #444;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            height: 200px;
            resize: vertical;
        }
        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .submit-button:hover {
            background-color: #45a049;
        }
        .story-author {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .story-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .like-button, .share-button {
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .like-button.liked {
            background-color: #ff3333;
            opacity: 0.8;
        }
        
        .like-button[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .like-button:hover:not([disabled]) {
            background-color: #ff3333;
        }
        
        .share-button {
            background-color: #4d79ff;
            color: white;
        }
        
        .share-button:hover {
            background-color: #3366ff;
        }
        
        .stories-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .message {
            padding: 10px 20px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .success-message {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
        }
        
        .error-message {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
        }
        
        .form-group .error {
            color: #a94442;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .search-container {
            margin: 20px 0;
            position: relative;
        }
        
        #searchInput {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        #searchInput:focus {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76,175,80,0.2);
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .story-container.hidden {
            display: none;
        }
        
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            display: none;
        }
        .auth-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
        }
        
        .auth-container.active {
            display: block;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-info {
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .auth-info.active {
            display: flex;
        }
        
        .logout-button {
            background-color: #ff4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .user-name {
            font-weight: bold;
            color: #333;
        }
        
        #myStoriesBtn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #myStoriesBtn:hover {
            background-color: #45a049;
        }
        
        .nav-menu button.active {
            background-color: #45a049;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .no-stories-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
            color: #666;
        }

        .toggle-password:hover {
            color: #333;
        }

        .password-container input {
            width: 100%;
            padding-right: 35px;
        }

        #likedStoriesBtn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #likedStoriesBtn:hover {
            background-color: #45a049;
        }
        
        #likedStoriesBtn.active {
            background-color: #45a049;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <nav class="nav-menu">
        <ul>
            <li><button id="myStoriesBtn" onclick="showMyStories()" style="display: none;">–ú–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏</button></li>
            <li><button id="likedStoriesBtn" onclick="showLikedStories()" style="display: none;">–ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è</button></li>
            <li class="auth-buttons" id="authButtons">
                <button onclick="showAuthForm('login')">–í–æ–π—Ç–∏</button>
                <button onclick="showAuthForm('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </li>
            <li class="auth-info" id="authInfo">
                <span class="user-name" id="userName"></span>
                <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏</button>
            </li>
        </ul>
    </nav>
    
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∏—Å—Ç–æ—Ä–∏–π</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É –∏—Å—Ç–æ—Ä–∏–∏...">
        <span class="search-icon">üîç</span>
    </div>
    
    <div id="noResults" class="no-results">
        –ò—Å—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    </div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏—Å—Ç–æ—Ä–∏–π -->
    <div class="stories-container">
        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 1</h2>
            <div class="story-text">
                –í –æ–¥–∏–Ω –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å –≤ –º–∞–ª–µ–Ω—å–∫–æ–º –≥–æ—Ä–æ–¥–∫–µ —Å–ª—É—á–∏–ª–æ—Å—å –Ω–µ—á—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ–µ. 
                –í—Å–µ –∂–∏—Ç–µ–ª–∏ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –∏—Ö –¥–æ–º–∞ –æ–∫—Ä–∞—Å–∏–ª–∏—Å—å –≤ —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ä–∞–¥—É–≥–∏. 
                –ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –Ω–æ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–∞–≤—Å–µ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª –∂–∏–∑–Ω—å –≥–æ—Ä–æ–∂–∞–Ω...
            </div>
        </div>

        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 2</h2>
            <div class="story-text">
                –ù–∞ –æ–∫—Ä–∞–∏–Ω–µ –ª–µ—Å–∞ –∂–∏–ª —Å—Ç–∞—Ä—ã–π –º—É–¥—Ä–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–ª —è–∑—ã–∫ –∂–∏–≤–æ—Ç–Ω—ã—Ö. 
                –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –∫ –Ω–µ–º—É –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –ª–µ—Å–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª–∏ —Å–≤–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏. 
                –û–¥–Ω–∞–∂–¥—ã –ø—Ä–æ–∏–∑–æ—à–ª–æ —á—Ç–æ-—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ...
            </div>
        </div>
    </div>

    <div class="story-form">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é</h2>
        <div id="successMessage" class="message success-message">–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</div>
        <div id="errorMessage" class="message error-message"></div>
        <form id="newStoryForm">
            <div class="form-group">
                <label for="storyTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <input type="text" id="storyTitle" name="storyTitle" required>
                <div class="error" id="titleError"></div>
            </div>
            
            <div class="form-group">
                <label for="storyText">–¢–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <textarea id="storyText" name="storyText" required></textarea>
                <div class="error" id="textError"></div>
            </div>
            
            <button type="submit" class="submit-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </form>
    </div>

    <div class="auth-container" id="authContainer">
        <h2 id="authTitle">–í—Ö–æ–¥</h2>
        <form id="authForm">
            <div class="form-group">
                <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="username" name="username" required>
                <div class="error" id="usernameError"></div>
            </div>
            
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <div class="password-container">
                    <input type="password" id="password" name="password" required>
                    <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
                <div class="error" id="passwordError"></div>
            </div>
            
            <button type="submit" class="submit-button">–í–æ–π—Ç–∏</button>
        </form>
    </div>

    <script>
        function validateStory(data) {
            let isValid = true;
            const errors = {};
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ XSS
            const sanitizeInput = (input) => {
                return input.replace(/[<>]/g, '');
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
            if (!data.storyTitle || data.storyTitle.trim().length < 3) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                isValid = false;
            } else if (data.storyTitle.length > 100) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
            if (!data.storyText || data.storyText.trim().length < 10) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            } else if (data.storyText.length > 5000) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 5000 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            // –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            if (isValid) {
                data.storyTitle = sanitizeInput(data.storyTitle);
                data.storyText = sanitizeInput(data.storyText);
            }
            
            return { isValid, errors };
        }

        function showError(fieldId, message) {
            const errorDiv = document.getElementById(`${fieldId}Error`);
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                const input = document.getElementById(fieldId);
                if (input) {
                    input.style.borderColor = '#ff4444';
                    input.addEventListener('focus', function() {
                        this.style.borderColor = '';
                        errorDiv.style.display = 'none';
                    }, { once: true });
                }
            }
        }

        function clearErrors() {
            const errorDivs = document.querySelectorAll('.error');
            errorDivs.forEach(div => {
                div.textContent = '';
                div.style.display = 'none';
            });
        }

        function showMessage(type, message) {
            try {
                const successMsg = document.getElementById('successMessage');
                const errorMsg = document.getElementById('errorMessage');
                
                if (!successMsg || !errorMsg) return;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                successMsg.style.display = 'none';
                errorMsg.style.display = 'none';
                
                const messageElement = type === 'success' ? successMsg : errorMsg;
                messageElement.textContent = message || (type === 'success' ? '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!' : '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                messageElement.style.display = 'block';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –≤ localStorage
        function saveStoriesToLocalStorage(stories) {
            try {
                localStorage.setItem('stories', JSON.stringify(stories));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –∏–∑ localStorage
        function getStoriesFromLocalStorage() {
            try {
                const stories = localStorage.getItem('stories');
                return stories ? JSON.parse(stories) : [];
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π:', error);
                return [];
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π
        function displayStories(storiesFilter = null) {
            try {
                const storiesContainer = document.querySelector('.stories-container');
                if (!storiesContainer) return;
                
                const stories = getStoriesFromLocalStorage();
                const currentUser = getCurrentUser();
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏–∏
                const filteredStories = storiesFilter ? 
                    stories.filter(storiesFilter) : 
                    stories;
                
                storiesContainer.innerHTML = '';
                
                if (filteredStories.length === 0) {
                    storiesContainer.innerHTML = `
                        <div class="no-stories-message">
                            ${storiesFilter ? '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–π' : '–ò—Å—Ç–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç'}
                        </div>
                    `;
                    return;
                }
                
                filteredStories.forEach(story => {
                    if (!story || !story.id) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏
                    
                    const hasLiked = currentUser && story.likedBy && story.likedBy.includes(currentUser.username);
                    const likeButtonClass = hasLiked ? 'like-button liked' : 'like-button';
                    const likeButtonDisabled = !currentUser ? 'disabled' : '';
                    const likeTitle = !currentUser ? '–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫' : 
                                    hasLiked ? '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –ª–∞–π–∫' : '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫';
                    
                    const storyHTML = `
                        <div class="story-container" data-id="${story.id}">
                            <h2 class="story-title">${story.storyTitle || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h2>
                            <p class="story-author">–ê–≤—Ç–æ—Ä: ${story.authorName || '–ê–Ω–æ–Ω–∏–º'}</p>
                            <div class="story-text">${story.storyText || ''}</div>
                            <div class="story-actions">
                                <button class="${likeButtonClass}" ${likeButtonDisabled} 
                                    onclick="handleLike(this, '${story.id}')"
                                    title="${likeTitle}"
                                >‚ù§ ${story.likes || 0}</button>
                                <button class="share-button">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                            </div>
                        </div>
                    `;
                    storiesContainer.insertAdjacentHTML('afterbegin', storyHTML);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–π');
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∞–π–∫–æ–≤
        function handleLike(button, storyId) {
            try {
                const currentUser = getCurrentUser();
                if (!currentUser) {
                    showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                    return;
                }
                
                if (!isStorageAvailable()) {
                    showMessage('error', '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
                    return;
                }
                
                const stories = getStoriesFromLocalStorage();
                const story = stories.find(s => s.id && s.id.toString() === storyId.toString());
                
                if (!story) {
                    console.error('–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –ª–∞–π–∫–æ–≤, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!Array.isArray(story.likedBy)) {
                    story.likedBy = [];
                }
                
                const hasLiked = story.likedBy.includes(currentUser.username);
                
                if (hasLiked) {
                    // –£–±–∏—Ä–∞–µ–º –ª–∞–π–∫
                    story.likedBy = story.likedBy.filter(username => username !== currentUser.username);
                    story.likes = Math.max(0, (story.likes || 1) - 1);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –ª–∞–π–∫
                    story.likedBy.push(currentUser.username);
                    story.likes = (story.likes || 0) + 1;
                }
                
                saveStoriesToLocalStorage(stories);
                displayStories(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∏—Å—Ç–æ—Ä–∏–π
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ª–∞–π–∫–∞:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ª–∞–π–∫–∞');
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showMyStories() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            const allButtons = document.querySelectorAll('.nav-menu button, .nav-menu a');
            allButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('myStoriesBtn').classList.add('active');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            displayStories(story => story.authorName === currentUser.username);
            
            showMessage('success', '–ü–æ–∫–∞–∑–∞–Ω—ã –≤–∞—à–∏ –∏—Å—Ç–æ—Ä–∏–∏');
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('newStoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearErrors();
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const formData = new FormData(e.target);
            const storyData = Object.fromEntries(formData);
            
            const { isValid, errors } = validateStory(storyData);
            
            if (!isValid) {
                Object.keys(errors).forEach(key => {
                    showError(key, errors[key]);
                });
                return;
            }
            
            try {
                const newStory = {
                    ...storyData,
                    id: Date.now().toString(), // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
                    authorName: currentUser.username,
                    date: new Date().toISOString(),
                    likes: 0,
                    likedBy: []
                };
                
                const stories = getStoriesFromLocalStorage();
                stories.unshift(newStory);
                saveStoriesToLocalStorage(stories);
                
                displayStories();
                e.target.reset();
                showMessage('success', '–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        });

        function searchStories(query) {
            const stories = document.querySelectorAll('.story-container');
            const noResults = document.getElementById('noResults');
            let hasVisibleStories = false;
            
            stories.forEach(story => {
                const title = story.querySelector('.story-title').textContent.toLowerCase();
                const text = story.querySelector('.story-text').textContent.toLowerCase();
                const author = story.querySelector('.story-author')?.textContent.toLowerCase() || '';
                
                const searchQuery = query.toLowerCase();
                
                if (title.includes(searchQuery) || 
                    text.includes(searchQuery) || 
                    author.includes(searchQuery)) {
                    story.classList.remove('hidden');
                    hasVisibleStories = true;
                } else {
                    story.classList.add('hidden');
                }
            });
            
            noResults.style.display = hasVisibleStories ? 'none' : 'block';
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Å debounce
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', debounce((e) => {
            searchStories(e.target.value);
        }, 300));

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Escape') {
                searchInput.value = '';
                searchStories('');
            }
        });

        // –î–æ–±–∞–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ localStorage
        function isStorageAvailable() {
            try {
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }

        // –û–±–Ω–æ–≤–∏–º —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
        function saveUsers(users) {
            try {
                if (!isStorageAvailable()) {
                    showMessage('error', '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ.');
                    return false;
                }
                localStorage.setItem('users', JSON.stringify(users));
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                showMessage('error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞.');
                return false;
            }
        }

        function getUsers() {
            try {
                if (!isStorageAvailable()) {
                    showMessage('error', '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ.');
                    return [];
                }
                const users = localStorage.getItem('users');
                return users ? JSON.parse(users) : [];
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                return [];
            }
        }

        function getCurrentUser() {
            try {
                const userJson = localStorage.getItem('currentUser');
                return userJson ? JSON.parse(userJson) : null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                return null;
            }
        }

        function setCurrentUser(user) {
            try {
                if (!isStorageAvailable()) {
                    showMessage('error', '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
                    return false;
                }
                localStorage.setItem('currentUser', JSON.stringify(user));
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showMessage('error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return false;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthForm(type) {
            const authContainer = document.getElementById('authContainer');
            const authTitle = document.getElementById('authTitle');
            const authForm = document.getElementById('authForm');
            
            clearErrors();
            authContainer.classList.add('active');
            authTitle.textContent = type === 'login' ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
            authForm.dataset.type = type;
            authForm.reset();
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—Ö–æ–¥–∞
        function logout() {
            try {
                localStorage.removeItem('currentUser');
                updateAuthUI();
                showMessage('success', '–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                displayStories(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
        function updateAuthUI() {
            const currentUser = getCurrentUser();
            const authButtons = document.getElementById('authButtons');
            const authInfo = document.getElementById('authInfo');
            const userName = document.getElementById('userName');
            const storyForm = document.querySelector('.story-form');
            const myStoriesBtn = document.getElementById('myStoriesBtn');
            const likedStoriesBtn = document.getElementById('likedStoriesBtn');
            
            if (currentUser) {
                authButtons.style.display = 'none';
                authInfo.classList.add('active');
                userName.textContent = currentUser.username;
                storyForm.style.display = 'block';
                myStoriesBtn.style.display = 'block';
                likedStoriesBtn.style.display = 'block';
            } else {
                authButtons.style.display = 'flex';
                authInfo.classList.remove('active');
                userName.textContent = '';
                storyForm.style.display = 'none';
                myStoriesBtn.style.display = 'none';
                likedStoriesBtn.style.display = 'none';
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏—Ö—Å—è –∏—Å—Ç–æ—Ä–∏–π
        function showLikedStories() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            const allButtons = document.querySelectorAll('.nav-menu button');
            allButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('likedStoriesBtn').classList.add('active');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –∏—Å—Ç–æ—Ä–∏–∏
            displayStories(story => story.likedBy && story.likedBy.includes(currentUser.username));
            
            const stories = document.querySelectorAll('.story-container');
            if (stories.length === 0) {
                document.querySelector('.stories-container').innerHTML = `
                    <div class="no-stories-message">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏—Ö—Å—è –∏—Å—Ç–æ—Ä–∏–π
                    </div>
                `;
            }
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleButton = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
                if (!isStorageAvailable()) {
                    console.warn('localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    return;
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                if (!localStorage.getItem('stories')) {
                    localStorage.setItem('stories', JSON.stringify([]));
                }
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏–∏
                updateAuthUI();
                displayStories();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–æ—Ä–º
                initializeEventListeners();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        });

        function initializeEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', handleAuthSubmit);
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
            const storyForm = document.getElementById('newStoryForm');
            if (storyForm) {
                storyForm.addEventListener('submit', handleStorySubmit);
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce((e) => {
                    searchStories(e.target.value);
                }, 300));
                
                searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Escape') {
                        searchInput.value = '';
                        searchStories('');
                    }
                });
            }
        }

        function handleAuthSubmit(e) {
            e.preventDefault();
            clearErrors();
            
            if (!isStorageAvailable()) {
                showMessage('error', '–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞.');
                return;
            }
            
            const type = e.target.dataset.type;
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showMessage('error', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                if (type === 'register') {
                    handleRegistration(username, password);
                } else {
                    handleLogin(username, password);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
            }
        }

        function handleRegistration(username, password) {
            const users = getUsers();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (users.some(u => u.username === username)) {
                showError('username', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
            if (password.length < 6) {
                showError('password', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            const newUser = { 
                username, 
                password,
                registrationDate: new Date().toISOString()
            };
            
            users.push(newUser);
            
            if (saveUsers(users)) {
                setCurrentUser(newUser);
                showMessage('success', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                document.getElementById('authContainer').classList.remove('active');
                document.getElementById('authForm').reset();
                updateAuthUI();
            }
        }

        function handleLogin(username, password) {
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            
            if (!user) {
                if (!users.some(u => u.username === username)) {
                    showError('username', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω');
                } else {
                    showError('password', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                }
                return;
            }
            
            if (setCurrentUser(user)) {
                showMessage('success', '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                document.getElementById('authContainer').classList.remove('active');
                document.getElementById('authForm').reset();
                updateAuthUI();
            }
        }

        function handleStorySubmit(e) {
            e.preventDefault();
            clearErrors();
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const formData = new FormData(e.target);
            const storyData = Object.fromEntries(formData);
            
            const { isValid, errors } = validateStory(storyData);
            if (!isValid) {
                Object.keys(errors).forEach(key => showError(key, errors[key]));
                return;
            }
            
            try {
                const newStory = {
                    ...storyData,
                    id: Date.now().toString(),
                    authorName: currentUser.username,
                    date: new Date().toISOString(),
                    likes: 0,
                    likedBy: []
                };
                
                const stories = getStoriesFromLocalStorage();
                stories.unshift(newStory);
                saveStoriesToLocalStorage(stories);
                
                displayStories();
                e.target.reset();
                showMessage('success', '–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        }
    </script>
</body>
</html> 
